<!DOCTYPE html>

<head>
    <style>
        body {
            margin: 0;
            height: 100vh;
            background-color: azure;
        }

        .container {
            /* display: flex; */
        }

        .box {
            /* width: 30px; */
            height: 30px;
        }
    </style>
</head>

<body>
    <ol class="container" style="background-color: beige;">
        <li style="width: 100px; height: 100px; background-color: aqua;">dasdasdsad</li>
        <li style="width: 100px; height: 100px; background-color: aqua;">dasdsadsad</li>
        <li style="width: 100px; height: 100px; background-color: aqua;">dasdsadasdd</li>
        <li style="width: 100px; height: 100px; background-color: aqua;">dasdasdwsad</li>
    </ol>
</body>
<script>
    // let windowHieght = document.body.clientHeight
    // const container = document.querySelector(".container")
    // let index = 0
    // let divHeight = 30
    // let step = Math.ceil(windowHieght / divHeight)
    // function parse() {
    //     let scrollStartX = document.body.scrollTop
    //     let temp = (scrollStartX + windowHieght) - index * divHeight
    //     if(temp > 0) {
    //         let tempNum = Math.ceil(temp / divHeight)
    //         for(let i = 0; i < tempNum; i++) {
    //             const divDom = document.createElement("div")
    //             divDom.classList.add("box")
    //             divDom.style.cssText = `background-color: rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255});`
    //             container.appendChild(divDom)
    //         }
    //     }
    // }
    // parse()
    // document.body.addEventListener("scroll", parse)

    // function checkIfInstanceOf(obj, classFunction) {
    //     console.log(typeof classFunction);
    //     if (classFunction === null || (typeof classFunction !== "object" && typeof classFunction !== "function")) {
    //         return false
    //     }
    //     return obj instanceof classFunction
    // };
    // console.log(checkIfInstanceOf(new Date(), Date));
    function cancellable(generator) {
        function wait(promise, generator, resolve, reject) {
            promise.then((value) => {
                let item = generator.next(value)
                while (!item.done) {
                    item = generator.next(item.value)
                    console.log(item);
                    if (item.value instanceof Promise) {
                        item.value = wait(item.value, generator, resolve, reject)
                    }
                }
            }).catch((e) => {
                reject(e)
            })
        }


        let cancelFn = () => { }
        const temp = new Promise((resolve, reject) => {
            try {
                cancelFn = () => {
                    reject("Cancelled")
                }
                let item = generator.next()
                console.log(item);
                while (!(item.value instanceof Promise) && !item.done) {
                    console.log(item);
                    item = generator.next(item.value)
                }
                let tempResult = item.value
                if(item.value instanceof Promise) {
                    let tempResult = wait(item.value, generator, reject)
                }
                resolve(item.value)
            } catch (e) {
                reject(e)
            }
        })
        return [cancelFn, temp]
    };

    function* tasks() {
        const val = yield new Promise(resolve => resolve(2 + 2));
        yield new Promise(resolve => setTimeout(resolve, 10));
        return val + 1;
    }
    const [cancel, promise] = cancellable(tasks());
    console.log(promise);
    // setTimeout(cancel, 50);
    cancel()
    promise.catch(e => console.log(e)); // logs "Cancelled" at t=50ms

</script>